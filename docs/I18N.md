# Thorix i18n (Internationalization)

Thorix provides a powerful internationalization system built on top of its reactive signals, allowing you to create multilingual applications with automatic updates when the locale changes.

## Table of Contents

- [Quick Start](#quick-start)
- [Core Concepts](#core-concepts)
- [API Reference](#api-reference)
- [Advanced Features](#advanced-features)
- [Extraction Tools](#extraction-tools)
- [Best Practices](#best-practices)
- [Examples](#examples)

## Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Set Up i18n

```typescript
import { createI18n, setGlobalI18n } from 'thorix';

// Import translation files
import enTranslations from './locales/en.json';
import esTranslations from './locales/es.json';
import frTranslations from './locales/fr.json';

const translations = {
  en: enTranslations,
  es: esTranslations,
  fr: frTranslations,
};

const i18n = createI18n(translations, {
  defaultLocale: 'en',
  fallbackLocale: 'en',
});

setGlobalI18n(i18n);
```

### 3. Create Translation Files

Create JSON files for each locale in your `locales/` directory:

**`locales/en.json`:**

```json
{
  "welcome": "Welcome to Thorix!",
  "hello": "Hello, {name}!",
  "navigation": {
    "home": "Home",
    "about": "About",
    "contact": "Contact"
  },
  "buttons": {
    "save": "Save",
    "cancel": "Cancel",
    "submit": "Submit"
  }
}
```

**`locales/es.json`:**

```json
{
  "welcome": "¡Bienvenido a Thorix!",
  "hello": "¡Hola, {name}!",
  "navigation": {
    "home": "Inicio",
    "about": "Acerca de",
    "contact": "Contacto"
  },
  "buttons": {
    "save": "Guardar",
    "cancel": "Cancelar",
    "submit": "Enviar"
  }
}
```

**`locales/fr.json`:**

```json
{
  "welcome": "Bienvenue sur Thorix !",
  "hello": "Bonjour, {name} !",
  "navigation": {
    "home": "Accueil",
    "about": "À propos",
    "contact": "Contact"
  },
  "buttons": {
    "save": "Enregistrer",
    "cancel": "Annuler",
    "submit": "Soumettre"
  }
}
```

### Benefits of Using JSON Files

Using JSON files for translations provides several advantages:

- **Separation of Concerns**: Translations are separated from application logic
- **Easier Maintenance**: Translators can work on JSON files without touching code
- **Version Control**: Translation changes can be tracked separately from code changes
- **Reusability**: Translation files can be shared between projects
- **Tooling Support**: Better support for translation management tools and IDEs
- **Performance**: JSON files can be loaded asynchronously and cached
- **Scalability**: Easier to manage large numbers of translations

### File Structure

Your project structure should look like this:

```
src/
├── components/
├── locales/
│   ├── en.json
│   ├── es.json
│   ├── fr.json
│   └── ...
├── i18n.ts
└── main.ts
```

### TypeScript Configuration

To enable JSON imports in TypeScript, add this to your `tsconfig.json`:

```json
{
  "compilerOptions": {
    "resolveJsonModule": true,
    "esModuleInterop": true
  }
}
```

This allows you to import JSON files directly as modules:

```typescript
import enTranslations from './locales/en.json';
import esTranslations from './locales/es.json';
```

### 3. Use in Components

```typescript
import { t, useLocale } from 'thorix';

function WelcomeComponent() {
  const { locale, setLocale } = useLocale();

  return div(
    { className: 'min-vh-100 d-flex flex-column' },
    // Header section
    div(
      { className: 'bg-primary text-white py-5 flex-shrink-0' },
      div(
        { className: 'container' },
        div(
          { className: 'row align-items-center' },
          div(
            { className: 'col-lg-8 col-md-7 mb-3 mb-md-0' },
            h1({ className: 'display-4 mb-2' }, t('welcome')),
            p(
              { className: 'lead mb-0' },
              t('hello', 'Hello, {name}!', { name: 'World' }),
            ),
          ),
          div(
            { className: 'col-lg-4 col-md-5' },
            div(
              {
                className:
                  'd-flex flex-wrap gap-2 justify-content-md-end justify-content-center',
              },
              button(
                {
                  onclick: () => setLocale('es'),
                  className: 'btn btn-light flex-fill flex-md-grow-0',
                },
                'Switch to Spanish',
              ),
              button(
                {
                  onclick: () => setLocale('fr'),
                  className: 'btn btn-outline-light flex-fill flex-md-grow-0',
                },
                'Switch to French',
              ),
            ),
          ),
        ),
      ),
    ),
    // Main content - flexible and growing
    div(
      { className: 'container flex-grow-1 py-4' },
      div(
        { className: 'row justify-content-center' },
        div(
          { className: 'col-lg-8 col-md-10' },
          div(
            { className: 'card shadow-sm' },
            div(
              { className: 'card-body text-center' },
              nav(
                { className: 'mb-4' },
                a(
                  { href: '#', className: 'btn btn-outline-primary me-2' },
                  t('navigation.home'),
                ),
                a(
                  { href: '#', className: 'btn btn-outline-primary me-2' },
                  t('navigation.about'),
                ),
                a(
                  { href: '#', className: 'btn btn-outline-primary' },
                  t('navigation.contact'),
                ),
              ),
            ),
          ),
        ),
      ),
    ),
  );
}
```

## Core Concepts

### Translation Function (`t`)

The `t` function is the heart of the i18n system. It takes a translation key and returns a reactive computed value that automatically updates when the locale changes.

```typescript
// Basic usage
t('welcome');

// With default message
t('welcome', 'Welcome to Thorix!');

// With parameters
t('hello', 'Hello, {name}!', { name: 'World' });
```

### Default Messages

Default messages provide fallback text when translations are missing:

```typescript
// If 'welcome.title' is not found, use the default message
t('welcome.title', 'Welcome to our application!');
```

### Parameter Interpolation

Use curly braces to insert dynamic values:

```typescript
t('greeting', 'Hello, {firstName} {lastName}!', {
  firstName: 'John',
  lastName: 'Doe',
});
```

### Pluralization

The `n` function handles pluralization automatically:

```typescript
// Automatically chooses between 'one' and 'other' forms
n('items', count, 'You have {count} items', { count });
```

## API Reference

### Core Functions

#### `t(key, defaultMessage?, params?)`

Translates a key with optional default message and parameters.

**Parameters:**

- `key` (string): Translation key
- `defaultMessage?` (string): Fallback text if translation is missing
- `params?` (Record<string, any>): Parameters for interpolation

**Returns:** `Computed<string>` - Reactive translation value

#### `n(key, count, defaultMessage?, params?)`

Handles pluralization with count-based translation selection.

**Parameters:**

- `key` (string): Base translation key
- `count` (number): Count for pluralization
- `defaultMessage?` (string): Fallback text
- `params?` (Record<string, any>): Parameters for interpolation

**Returns:** `Computed<string>` - Reactive pluralized translation

#### `formatDate(date, options?)`

Formats dates according to the current locale.

**Parameters:**

- `date` (Date): Date to format
- `options?` (Intl.DateTimeFormatOptions): Formatting options

**Returns:** `Computed<string>` - Reactive formatted date

#### `formatNumber(value, options?)`

Formats numbers according to the current locale.

**Parameters:**

- `value` (number): Number to format
- `options?` (Intl.NumberFormatOptions): Formatting options

**Returns:** `Computed<string>` - Reactive formatted number

### Helper Functions

#### `useLocale()`

Returns locale management utilities.

**Returns:**

```typescript
{
  locale: Signal<string>,
  setLocale: (locale: string) => void,
  availableLocales: string[]
}
```

#### `useNamespace(namespace)`

Creates a namespaced translation helper.

**Parameters:**

- `namespace` (string): Namespace prefix

**Returns:**

```typescript
{
  t: (key: string, defaultMessage?: string, params?: Record<string, any>) => Computed<string>,
  n: (key: string, count: number, defaultMessage?: string, params?: Record<string, any>) => Computed<string>
}
```

#### `tWithContext(key, context, defaultMessage?, params?)`

Translates with context-aware key construction.

**Parameters:**

- `key` (string): Translation key
- `context` (string): Context prefix
- `defaultMessage?` (string): Fallback text
- `params?` (Record<string, any>): Parameters

**Returns:** `Computed<string>` - Reactive translation value

### I18n Class

#### `createI18n(translations, config)`

Creates a new i18n instance.

**Parameters:**

- `translations` (LocaleData): Translation data for all locales
- `config` (I18nConfig): Configuration options

**Returns:** `I18n` - i18n instance

#### `setGlobalI18n(i18n)`

Sets the global i18n instance.

**Parameters:**

- `i18n` (I18n): i18n instance to set globally

#### `getGlobalI18n()`

Gets the global i18n instance.

**Returns:** `I18n` - Global i18n instance

**Throws:** Error if no global i18n is set

## Advanced Features

### Custom Date/Number Formats

```typescript
const i18n = createI18n(translations, {
  defaultLocale: 'en',
  dateTimeFormats: {
    en: {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    },
    es: {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    },
  },
  numberFormats: {
    en: {
      style: 'currency',
      currency: 'USD',
    },
    es: {
      style: 'currency',
      currency: 'EUR',
    },
  },
});
```

### Dynamic Locale Loading

```typescript
async function loadLocale(locale: string) {
  const response = await fetch(`/locales/${locale}.json`);
  const translations = await response.json();
  i18n.addTranslations(locale, translations);
}

// Load locale on demand
await loadLocale('ja');
i18n.setLocale('ja');
```

### Translation Functions

For complex translations, you can use functions:

```typescript
const translations = {
  en: {
    items: (params: { count: number }) => {
      if (params.count === 0) return 'No items';
      if (params.count === 1) return '1 item';
      return `${params.count} items`;
    },
  },
};
```

## Extraction Tools

Thorix includes a powerful extraction script that automatically finds translation keys in your code and generates locale files.

### Running the Extraction

```bash
# Extract translations from source files
npm run i18n:extract

# Watch mode for development
npm run i18n:extract:watch
```

### What the Script Does

1. **Scans Source Files**: Looks for `t()`, `n()`, `useNamespace()`, and `tWithContext()` calls
2. **Extracts Keys**: Identifies translation keys and default messages
3. **Generates Locale Files**: Creates JSON files for all supported locales
4. **TypeScript Types**: Generates type definitions for translation keys
5. **Usage Report**: Creates a markdown report showing where each key is used

### Configuration

Modify the `CONFIG` object in `scripts/i18n-extract.js`:

```javascript
const CONFIG = {
  sourceFiles: ['src/**/*.{ts,tsx,js,jsx}', 'examples/**/*.{ts,tsx,js,jsx}'],
  localesDir: 'locales',
  defaultLocale: 'en',
  supportedLocales: ['en', 'es', 'fr', 'de', 'ja', 'zh'],
  // ... more options
};
```

### Generated Files

The script creates:

- `locales/en.json` - Default locale (English)
- `locales/es.json` - Spanish translations
- `locales/fr.json` - French translations
- `locales/types.ts` - TypeScript type definitions
- `locales/usage-report.md` - Usage documentation

## Best Practices

### 1. Use Descriptive Keys

```typescript
// Good
t('user.profile.title', 'User Profile');
t('navigation.home', 'Home');

// Avoid
t('title', 'User Profile');
t('nav1', 'Home');
```

### 2. Provide Default Messages

Always provide default messages for better developer experience:

```typescript
// Good
t('welcome.message', 'Welcome to our application!');

// Avoid
t('welcome.message');
```

### 3. Use Namespaces for Organization

```typescript
const userNamespace = useNamespace('user');
const navNamespace = useNamespace('navigation');

userNamespace.t('profile.title', 'User Profile');
navNamespace.t('home', 'Home');
```

### 4. Handle Missing Translations Gracefully

```typescript
// The system automatically falls back to default messages
// But you can also handle missing keys explicitly
const translation = t('key', 'Default message');
if (translation.get() === 'key') {
  console.warn('Translation key "key" is missing');
}
```

### 5. Use Parameters for Dynamic Content

```typescript
// Good - reusable
t('greeting', 'Hello, {name}!', { name: userName });

// Avoid - hardcoded
t('greeting.john', 'Hello, John!');
t('greeting.jane', 'Hello, Jane!');
```

### 6. Leverage Pluralization

```typescript
// Automatically handles different forms
n('items', count, 'You have {count} items', { count });
```

## Examples

### Basic Component

```typescript
function WelcomeComponent() {
  const { locale, setLocale } = useLocale();

  return div(
    { className: 'min-vh-100 d-flex flex-column' },
    // Header section
    div(
      { className: 'bg-primary text-white py-5 flex-shrink-0' },
      div(
        { className: 'container' },
        div(
          { className: 'row align-items-center' },
          div(
            { className: 'col-lg-8 col-md-7 mb-3 mb-md-0' },
            h1({ className: 'display-4 mb-2' }, t('welcome.title', 'Welcome!')),
            p(
              { className: 'lead mb-0' },
              t('welcome.subtitle', 'Choose your language'),
            ),
          ),
          div(
            { className: 'col-lg-4 col-md-5' },
            div(
              {
                className:
                  'd-flex flex-wrap gap-2 justify-content-md-end justify-content-center',
              },
              button(
                {
                  onclick: () => setLocale('en'),
                  className: 'btn btn-light flex-fill flex-md-grow-0',
                },
                'English',
              ),
              button(
                {
                  onclick: () => setLocale('es'),
                  className: 'btn btn-outline-light flex-fill flex-md-grow-0',
                },
                'Español',
              ),
            ),
          ),
        ),
      ),
    ),
    // Main content - flexible and growing
    div(
      { className: 'container flex-grow-1 py-4' },
      div(
        { className: 'row justify-content-center' },
        div(
          { className: 'col-lg-8 col-md-10' },
          div(
            { className: 'card shadow-sm' },
            div(
              { className: 'card-body text-center' },
              h2(
                { className: 'card-title h3 mb-4' },
                t('welcome.content', 'Welcome to our application'),
              ),
              p(
                { className: 'card-text' },
                t(
                  'welcome.description',
                  'This is an example of an elastic layout using Bootstrap classes.',
                ),
              ),
            ),
          ),
        ),
      ),
    ),
  );
}
```

### Form with Validation

```typescript
function ContactForm() {
  const name = signal('');
  const email = signal('');

  const nameError = computed(() => {
    if (name.get().length === 0) {
      return t('validation.required', 'This field is required');
    }
    return '';
  });

  const emailError = computed(() => {
    if (!email.get().includes('@')) {
      return t('validation.email', 'Please enter a valid email');
    }
    return '';
  });

  return form(
    { className: 'min-vh-100 d-flex flex-column' },
    // Header section
    div(
      { className: 'bg-primary text-white py-4 flex-shrink-0' },
      div(
        { className: 'container' },
        h1(
          { className: 'display-5 text-center mb-0' },
          t('form.title', 'Contact Form'),
        ),
      ),
    ),
    // Main content - flexible and growing
    div(
      { className: 'container flex-grow-1 py-4' },
      div(
        { className: 'row justify-content-center' },
        div(
          { className: 'col-lg-6 col-md-8' },
          div(
            { className: 'card shadow-sm' },
            div(
              { className: 'card-body' },
              h2(
                { className: 'card-title h4 mb-4' },
                t('form.subtitle', 'Get in touch with us'),
              ),
              div(
                { className: 'mb-3' },
                label({ className: 'form-label' }, t('form.name', 'Name')),
                input({
                  className: 'form-control',
                  value: name.get(),
                  oninput: (e) => name.set(e.target.value),
                }),
                span({ className: 'text-danger small' }, nameError),
              ),
              div(
                { className: 'mb-4' },
                label({ className: 'form-label' }, t('form.email', 'Email')),
                input({
                  className: 'form-control',
                  value: email.get(),
                  oninput: (e) => email.set(e.target.value),
                }),
                span({ className: 'text-danger small' }, emailError),
              ),
              button(
                {
                  type: 'submit',
                  className: 'btn btn-primary w-100',
                },
                t('form.submit', 'Submit'),
              ),
            ),
          ),
        ),
      ),
    ),
  );
}
```

### List with Pluralization

```typescript
function ItemList() {
  const items = signal(['Apple', 'Banana', 'Orange']);

  return div(
    { className: 'min-vh-100 d-flex flex-column' },
    // Header section
    div(
      { className: 'bg-success text-white py-4 flex-shrink-0' },
      div(
        { className: 'container' },
        h1(
          { className: 'display-5 text-center mb-0' },
          t('list.header', 'Item List'),
        ),
      ),
    ),
    // Main content - flexible and growing
    div(
      { className: 'container flex-grow-1 py-4' },
      div(
        { className: 'row justify-content-center' },
        div(
          { className: 'col-lg-8 col-md-10' },
          div(
            { className: 'card shadow-sm' },
            div(
              { className: 'card-body' },
              h2(
                { className: 'card-title h4 mb-4' },
                n('list.title', items.get().length, 'You have {count} items', {
                  count: items.get().length,
                }),
              ),
              div(
                { className: 'list-group list-group-flush' },
                ...items.get().map((item, index) =>
                  div(
                    {
                      className:
                        'list-group-item d-flex justify-content-between align-items-center',
                      key: index,
                    },
                    span(item),
                    span(
                      { className: 'badge bg-primary rounded-pill' },
                      index + 1,
                    ),
                  ),
                ),
              ),
            ),
          ),
        ),
      ),
    ),
  );
}
```

### Date and Number Formatting

```typescript
function Dashboard() {
  const today = new Date();
  const revenue = 1234567.89;

  return div(
    { className: 'min-vh-100 d-flex flex-column' },
    // Header section
    div(
      { className: 'bg-info text-white py-4 flex-shrink-0' },
      div(
        { className: 'container' },
        h1(
          { className: 'display-5 text-center mb-0' },
          t('dashboard.title', 'Dashboard'),
        ),
      ),
    ),
    // Main content - flexible and growing
    div(
      { className: 'container flex-grow-1 py-4' },
      div(
        { className: 'row g-4' },
        div(
          { className: 'col-lg-6' },
          div(
            { className: 'card shadow-sm h-100' },
            div(
              { className: 'card-body d-flex flex-column' },
              h2(
                { className: 'card-title h4 mb-3' },
                t('dashboard.dateTitle', 'Date Information'),
              ),
              div(
                { className: 'flex-grow-1' },
                p(
                  { className: 'card-text' },
                  t('dashboard.date', 'Today is {date}', {
                    date: formatDate(today).get(),
                  }),
                ),
              ),
            ),
          ),
        ),
        div(
          { className: 'col-lg-6' },
          div(
            { className: 'card shadow-sm h-100' },
            div(
              { className: 'card-body d-flex flex-column' },
              h2(
                { className: 'card-title h4 mb-3' },
                t('dashboard.revenueTitle', 'Financial Data'),
              ),
              div(
                { className: 'flex-grow-1' },
                p(
                  { className: 'card-text' },
                  t('dashboard.revenue', 'Revenue: {amount}', {
                    amount: formatNumber(revenue, {
                      style: 'currency',
                      currency: 'USD',
                    }).get(),
                  }),
                ),
              ),
            ),
          ),
        ),
      ),
    ),
  );
}
```

## Troubleshooting

### Common Issues

1. **"Global i18n not initialized"**
   - Make sure to call `setGlobalI18n()` before using translation functions

2. **Translations not updating**
   - Check that you're using the `t()` function, not storing the result in a variable
   - Ensure the locale is being set correctly

3. **Missing translations**
   - Run `npm run i18n:extract` to generate missing locale files
   - Check that translation keys match exactly

4. **Type errors**
   - Run `npm run i18n:extract` to regenerate TypeScript types
   - Ensure translation keys are properly typed

### Debug Mode

Enable debug mode to see what's happening:

```typescript
import { setDebugMode } from 'thorix';

setDebugMode(true);
```

## Performance Considerations

- **Reactive Updates**: Only components using translations re-render when locale changes
- **Computed Values**: Translations are computed values that cache results
- **Lazy Loading**: Load locales on demand to reduce initial bundle size
- **Tree Shaking**: Unused translations can be tree-shaken in production builds

## Migration from Other i18n Libraries

### From react-i18next

```typescript
// Before (react-i18next)
const { t } = useTranslation();
t('welcome');

// After (Thorix)
import { t } from 'thorix';
t('welcome', 'Welcome');
```

### From vue-i18n

```typescript
// Before (vue-i18n)
$t('welcome');

// After (Thorix)
import { t } from 'thorix';
t('welcome', 'Welcome');
```

The Thorix i18n system provides a modern, reactive approach to internationalization that integrates seamlessly with the library's reactive architecture.
