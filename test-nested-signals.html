<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Nested Signals Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .counter {
        border: 1px solid #ccc;
        padding: 20px;
        margin: 10px;
      }
      .log {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>Test Nested Signals Fix</h1>
    <div id="app"></div>

    <div class="log" id="log"></div>

    <script type="module">
      import {
        button,
        component,
        div,
        h1,
        p,
        render,
        signal,
      } from '../dist/tacit-dom.esm.js';

      // Simple counter component
      const counter = component((props) => {
        console.log(`Counter ${props.name} renders`);

        // Create a local signal
        const count = signal(props.initialValue || 0);

        const increment = () => {
          count.update((prev) => prev + 1);
          console.log(`${props.name} count:`, count.get());
          log(`${props.name} count: ${count.get()}`);
        };

        return div(
          { className: 'counter' },
          h1(`${props.name}: ${count.get()}`),
          button({ onclick: increment }, 'Increment'),
        );
      });

      // Main app component
      const app = component(() => {
        console.log('App renders');
        log('App renders');

        return div(
          h1('Nested Signals Test'),
          p('Click the increment buttons to test if signals persist'),
          counter({ name: 'Counter A', initialValue: 0 }),
          counter({ name: 'Counter B', initialValue: 10 }),
        );
      });

      function log(message) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += message + '<br>';
      }

      // Mount the app
      render(app, document.getElementById('app'));
    </script>
  </body>
</html>
